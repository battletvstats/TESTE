<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estatísticas - Player Stats</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0f0f10;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
      color: #fff;
    }

    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      background-color: #4d0000;
      border-radius: 5px;
      color: #ccc;
      transition: 0.3s;
      text-align: center;
      font-weight: bold;
    }

    .tab:hover {
      background-color: #800000;
      color: #fff;
    }

    .tab.active {
      background-color: #b30000;
      color: #fff;
    }

    .table-wrapper {
      display: flex;
      justify-content: center;
      padding: 0 40px;
      box-sizing: border-box;
      gap: 20px;
      align-items: flex-start;
    }

    .table-wrapper table {
      width: 100%;
      max-width: 1300px;
      border-collapse: collapse;
    }

    th {
      text-align: center;
      vertical-align: middle;
      padding: 10px 8px;
      font-weight: 600;
      font-size: 13px;
      color: #aaa;
      background-color: #1a1a1c;
    }

    td {
      text-align: center;
      vertical-align: middle;
      padding: 10px 8px;
      font-size: 14px;
      color: #eee;
      border: none;
      border-bottom: 1px solid #1c1c1f;
    }

    tr:nth-child(even) {
      background-color: #121214;
    }

    tr:hover {
      background-color: #1a1a1c;
    }

    .legend {
      font-size: 12px;
      background-color: #1a1a1c;
      padding: 15px;
      border-radius: 5px;
      min-width: 220px;
    }

    .legend table {
      border-collapse: collapse;
      width: 100%;
    }

    .legend td {
      padding: 4px 6px;
      vertical-align: top;
      color: #ccc;
    }

    .legend td:first-child {
      font-weight: bold;
      color: #fff;
      white-space: nowrap;
    }

    .rating-color {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>BattleFive Stats</h1>

  <div class="tabs">
    <div class="tab active" onclick="loadData('Stats Geral', this)">Stats Geral</div>
    <div class="tab" onclick="loadData('Invitational', this)">Invitational</div>
    <div class="tab" onclick="loadData('BFC Semana 2', this)">CUP Semana 2</div>
    <div class="tab" onclick="loadData('BFC Semana 3', this)">CUP Semana 3</div>
    <div class="tab" onclick="loadData('BFC Semana 5', this)">CUP Semana 5</div>
    <div class="tab" onclick="loadData('BFC Semana 6', this)">CUP Semana 6</div>
    <div class="tab" onclick="loadData('BFL Semana 2', this)">League Semana 2</div>
  </div>

  <div class="table-wrapper">
    <!-- LEGENDA -->
    <div class="legend">
      <table>
        <tr><td>Rating</td><td>Avaliação geral do jogador</td></tr>
        <tr><td>RDS</td><td>Rounds jogados</td></tr>
        <tr><td>K-D (+/-)</td><td>Kills e Mortes</td></tr>
        <tr><td>Entry (+/-)</td><td>Opening Kills / Deaths</td></tr>
        <tr><td>KST%</td><td>Kills / Survival / Trade</td></tr>
        <tr><td>KPR</td><td>Kills por Round</td></tr>
        <tr><td>SRV</td><td>Survival</td></tr>
        <tr><td>1vsX</td><td>Clutches</td></tr>
        <tr><td>1k-4k</td><td>Kills por rounds</td></tr>
        <tr><td>OK%</td><td>% de Sucesso em Opening Kills</td></tr>
        <tr><td>1vsX%</td><td>% de Sucesso em Clutches</td></tr>
      </table>
    </div>

    <!-- TABELA -->
    <table id="statsTable">
      <thead>
        <tr id="tableHeader"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const baseUrl = 'https://opensheet.elk.sh/1DNpe8pagrXOsY7WS6HICqBnILtMHDUIpz8Pfbu7iYMQ/';

    const columnMapStatsGeral = {
      "Player": "Player",
      "Rating": "Rating",
      "RDS": "Rounds",
      "K-D (+/-)": "K-D (+/-)",
      "Entry (+/-)": "Entry (+/-)",
      "KST%": "KST%",
      "KPR": "KPR",
      "SRV": "SRV",
      "1vsX": "1vsX",
      "1k": "1k",
      "2k": "2k",
      "3k": "3k",
      "4k": "4k",
      "OK%": "OK%",
      "1vsX%": "1vsX%",
      "Pistol Rating": "Pistol Rating",
      "Pistol K-D": "Pistol K-D",
      "Pistol Entry": "Pistol Entry"
    };

    const columnMapInvitational = { ...columnMapStatsGeral };
    const columnMapBFLSemana2 = { ...columnMapStatsGeral };

    function setTableHeader(columnsMap) {
      const header = document.getElementById("tableHeader");
      header.innerHTML = "";
      for (const col in columnsMap) {
        const th = document.createElement("th");
        th.textContent = columnsMap[col];
        header.appendChild(th);
      }
    }

    function setActiveTab(tabElement) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      tabElement.classList.add('active');
    }

    function getRatingColor(value) {
      const num = parseFloat(value);
      if (isNaN(num)) return '';
      if (num >= 1.35) return '#009e44';
      if (num >= 1.25) return '#4cbf50';
      if (num >= 1.15) return '#82c755';
      if (num >= 1.05) return '#c1d151';
      if (num >= 0.95) return '#f7d24c';
      if (num >= 0.85) return '#f3a046';
      if (num >= 0.75) return '#e26740';
      if (num >= 0.65) return '#d94436';
      return '#c2302e';
    }

    function getKSTColor(value) {
      const num = parseFloat(value.toString().replace('%', ''));
      if (isNaN(num)) return '';
      if (num >= 85) return '#27aa50';
      if (num >= 80) return '#52bb53';
      if (num >= 75) return '#7fc761';
      if (num >= 68) return '#adce58';
      if (num >= 62) return '#ffd554';
      if (num >= 55) return '#faaa56';
      if (num >= 50) return '#e78066';
      if (num >= 45) return '#f1605b';
      return '#ff3e44';
    }
    
    function fetchDataAndRender(url, columns) {
      const tbody = document.querySelector("#statsTable tbody");
      tbody.innerHTML = "";

      fetch(url)
        .then(response => response.json())
        .then(data => {
          data.forEach(row => {
            const tr = document.createElement("tr");

            columns.forEach(col => {
              const td = document.createElement("td");
              const value = row[col] || "—";

              if (col === "Rating" || col === "Pistol Rating") {
                td.textContent = value;
                td.classList.add("rating-color");
                td.style.color = getRatingColor(value);
              } 
              else if (col === "KST%" || col === "SRV") {
                td.textContent = value;
                td.classList.add("rating-color");
                td.style.color = getKSTColor(value);
              }
              else if (col === "KPR") {
                td.textContent = value;
                td.classList.add("rating-color");
                td.style.color = getRatingColor(value);
              } 
              else {
                td.textContent = value;
              }

              tr.appendChild(td);
            });

            tbody.appendChild(tr);
          });
        })
        .catch(err => {
          console.error(err);
          tbody.innerHTML = `<tr><td colspan="${columns.length}" style="color:red;">Erro ao carregar os dados.</td></tr>`;
        });
    }

    function loadData(sheetName, tabElement) {
      setActiveTab(tabElement);
      let columnsMap;
      if (sheetName === "Invitational") {
        columnsMap = columnMapInvitational;
      } else if (sheetName === "BFL Semana 2") {
        columnsMap = columnMapBFLSemana2;
      } else {
        columnsMap = columnMapStatsGeral;
      }

      setTableHeader(columnsMap);
      fetchDataAndRender(baseUrl + encodeURIComponent(sheetName), Object.keys(columnsMap));
    }

    loadData("Stats Geral", document.querySelector(".tab.active"));
  </script>
</body>
</html>
